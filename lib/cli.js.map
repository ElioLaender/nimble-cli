{"version":3,"file":"cli.js","sourceRoot":"","sources":["../src/cli.ts"],"names":[],"mappings":"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","sourcesContent":["import 'reflect-metadata';\r\nimport fs from 'fs-extra';\r\nimport path from 'path';\r\nimport { Container } from 'inversify';\r\nimport { DependencyRegister } from './dependency-register';\r\nimport { NB } from './nb';\r\n\r\nexport class CLI {\r\n    public static container = new Container();\r\n    public static nb: NB;\r\n    public static package: any;\r\n    public static nimbleVersion: string = '1.2.6';\r\n\r\n    public static get version() { return this.package ? this.package.version : '1.0.0'; }\r\n    public static get globalVersion(): string {\r\n\t\tif (this.workingInLocalProject()) {\r\n\t\t\ttry {\r\n\t\t\t\tif (process.mainModule) {\r\n\t\t\t\t\tlet globalPath = path.join(process.mainModule['path'], '../package.json');\r\n\t\t\t\t\tif (fs.existsSync(globalPath)) {\r\n\t\t\t\t\t\tlet packgeJson = JSON.parse(fs.readFileSync(globalPath, 'utf8'));\r\n\t\t\t\t\t\treturn packgeJson ? packgeJson.version : this.version;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcatch { return this.version; }\r\n\t\t}\r\n\t\treturn this.version;\r\n\t}\r\n\r\n    public static get worksPath() { return process.cwd(); }\r\n    \r\n    public static start() {\r\n        this.getInformation();\r\n        DependencyRegister.register(this.container);\r\n\r\n        this.nb = this.container.get<NB>('NB');\r\n        this.nb.setArgurments(process.argv.slice(2));\r\n        this.nb.start();\r\n    }\r\n\r\n    public static inject<T>(type: string) {\r\n        return this.container.get<T>(type);\r\n    }\r\n\r\n    public static hasGlobalInstalled(): boolean {\r\n\t\tif (this.workingInLocalProject()) {\r\n\t\t\ttry {\r\n\t\t\t\tlet packgeJson = require(\"../package.json\");\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tcatch {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n    public static workingInLocalProject() {\r\n\t\tlet projectRootPath = path.join(__dirname, '../../../../');\r\n\t\treturn fs.existsSync(`${projectRootPath}/nimble.json`);\r\n\t}\r\n\r\n    public static worksPathIsRootProject(path?: string) {\r\n        if (!path) path = this.worksPath;\r\n        if(!path.endsWith('/')) path += '/';\r\n\r\n        if (!fs.pathExistsSync(`${path}src`) || !fs.existsSync(`${path}package.json`)) {\r\n            return false\r\n        }\r\n        if (!fs.existsSync(`${path}nimble.json`)) {\r\n            return false;\r\n        }\r\n\r\n        let packageFile = null;\r\n        try { packageFile = require(`${path}package.json`); } catch {}\r\n        if (!packageFile || !packageFile['dependencies'] || !packageFile['dependencies']['@nimble-ts/core'])\r\n            return false;\r\n\r\n        return true;\r\n    }\r\n\r\n    public static worksPathIsSourceDir() {\r\n        let dirName = this.worksPath.split(path.sep).pop();\r\n        return dirName === 'src';\r\n    }\r\n\r\n    public static isNimbleProject() {\r\n        let parent = this.worksPath;\r\n        \r\n        let rootPath = path.parse(parent).root;\r\n\r\n        while(parent && parent !== rootPath) {\r\n            if (this.worksPathIsRootProject(parent))\r\n                return true;\r\n            parent = this.getParentPath(parent);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public static getNimbleProjectRootPath() {\r\n        let parent = this.worksPath;\r\n        let rootPath = path.parse(parent).root;\r\n\r\n        while(parent && parent !== rootPath) {\r\n            if (this.worksPathIsRootProject(parent))\r\n                return parent;\r\n            parent = this.getParentPath(parent);\r\n        }\r\n        return parent;\r\n    }\r\n\r\n    public static getParentPath(completePath: string) {\r\n        let parentPath = path.join(completePath + '/..');\r\n        return parentPath;\r\n    }\r\n\r\n    private static getInformation() {\r\n        try {\r\n            this.package = require('package.json');\r\n        }\r\n        catch {\r\n            this.package = require('../package.json');\r\n        }\r\n    }\r\n    \r\n}\r\n\r\nCLI.start();"]}