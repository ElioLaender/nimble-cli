{"version":3,"file":"build.js","sourceRoot":"","sources":["../../../src/commands/build/build.ts"],"names":[],"mappings":"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","sourcesContent":["import webpack from 'webpack';\r\nimport path from 'path';\r\nimport chalk from 'chalk';\r\nimport { inject, injectable } from 'inversify';\r\nimport { Logger } from '../../utils/logger.util';\r\nimport { ArgsResolver } from '../../core/args-resolver';\r\nimport { webpackConfig } from '../config/webpack.config';\r\nimport { PATHS } from '../../core/dev-utils/paths';\r\nimport { webpackDevServerUtils } from '../../core/dev-utils/webpack-dev-server-utils';\r\n\r\n@injectable()\r\nexport class Build {\r\n    private args!: ArgsResolver;\r\n\r\n    private DEFAULT_ENV = 'prod';\r\n    private WARN_AFTER_BUNDLE_GZIP_SIZE = 512 * 1024;\r\n    private WARN_AFTER_CHUNK_GZIP_SIZE = 1024 * 1024;\r\n\r\n    private get env() { return this.args.getValue('env', this.DEFAULT_ENV) as string; }\r\n\r\n    constructor(\r\n        @inject('Logger') private logger: Logger\r\n    ) {\r\n    }\r\n\r\n    public async execute(args: string[]) {\r\n        this.args = new ArgsResolver(args);\r\n\r\n        const config = webpackConfig(this.env, true);\r\n\r\n        this.build(config)\r\n            .then(\r\n                ({ stats, warnings }) => {\r\n                    if (warnings.length) {\r\n                        console.log(chalk.yellow('Compiled with warnings.\\n'));\r\n                        console.log(warnings.join('\\n\\n'));\r\n                        console.log(\r\n                            '\\nSearch for the ' +\r\n                            chalk.underline(chalk.yellow('keywords')) +\r\n                            ' to learn more about each warning.'\r\n                        );\r\n                        console.log(\r\n                            'To ignore, add ' +\r\n                            chalk.cyan('// eslint-disable-next-line') +\r\n                            ' to the line before.\\n'\r\n                        );\r\n                    } else {\r\n                        console.log(chalk.green('Compiled successfully.\\n'));\r\n                    }\r\n\r\n                    console.log('File sizes after gzip:\\n');\r\n                    /* printFileSizesAfterBuild(\r\n                        stats,\r\n                        PATHS.appBuild,\r\n                        this.WARN_AFTER_BUNDLE_GZIP_SIZE,\r\n                        this.WARN_AFTER_CHUNK_GZIP_SIZE\r\n                    );\r\n                    console.log(); */\r\n\r\n                    /* const appPackage = require(PATHS.appPackageJson);\r\n                    const publicUrl = PATHS.appPublic;\r\n                    const publicPath = config.output.publicPath;\r\n                    const buildFolder = path.relative(process.cwd(), PATHS.appBuild);\r\n                    printHostingInstructions(\r\n                        appPackage,\r\n                        publicUrl,\r\n                        publicPath,\r\n                        buildFolder\r\n                    ); */\r\n                },\r\n                err => {\r\n                    const tscCompileOnError = process.env.TSC_COMPILE_ON_ERROR === 'true';\r\n                    if (tscCompileOnError) {\r\n                        console.log(\r\n                            chalk.yellow(\r\n                                'Compiled with the following type errors (you may want to check these before deploying your app):\\n'\r\n                            )\r\n                        );\r\n                        // printBuildError(err);\r\n                    } else {\r\n                        console.log(chalk.red('Failed to compile.\\n'));\r\n                        // printBuildError(err);\r\n                        process.exit(1);\r\n                    }\r\n                }\r\n            )\r\n            .catch(err => {\r\n                if (err && err.message) {\r\n                    console.log(err.message);\r\n                }\r\n                process.exit(1);\r\n            });;\r\n    }\r\n\r\n    private build(config: any) {\r\n        if (process.env.NODE_PATH) {\r\n            console.log(\r\n                chalk.yellow(\r\n                    'Setting NODE_PATH to resolve modules absolutely has been deprecated in favor of setting baseUrl in jsconfig.json (or tsconfig.json if you are using TypeScript) and will be removed in a future major release of create-react-app.'\r\n                )\r\n            );\r\n            console.log();\r\n        }\r\n\r\n        console.log('Creating an optimized production build...');\r\n\r\n        const compiler = webpack(config);\r\n        return new Promise<{ stats: any, warnings: string[] }>((resolve, reject) => {\r\n            compiler.run((err, stats) => {\r\n                let messages;\r\n                if (err) {\r\n                    if (!err.message) {\r\n                        return reject(err);\r\n                    }\r\n\r\n                    let errMessage = err.message;\r\n\r\n                    if (Object.prototype.hasOwnProperty.call(err, 'postcssNode')) {\r\n                        errMessage +=\r\n                            '\\nCompileError: Begins at CSS selector ' +\r\n                            err['postcssNode'].selector;\r\n                    }\r\n\r\n                    messages = this.formatWebpackMessages({\r\n                        errors: [errMessage],\r\n                        warnings: [],\r\n                    });\r\n                } else {\r\n                    messages = this.formatWebpackMessages(\r\n                        stats.toJson({ all: false, warnings: true, errors: true })\r\n                    );\r\n                }\r\n                if (messages.errors.length) {\r\n                    if (messages.errors.length > 1) {\r\n                        messages.errors.length = 1;\r\n                    }\r\n                    return reject(new Error(messages.errors.join('\\n\\n')));\r\n                }\r\n                if (\r\n                    process.env.CI &&\r\n                    (typeof process.env.CI !== 'string' ||\r\n                        process.env.CI.toLowerCase() !== 'false') &&\r\n                    messages.warnings.length\r\n                ) {\r\n                    console.log(\r\n                        chalk.yellow(\r\n                            '\\nTreating warnings as errors because process.env.CI = true.\\n' +\r\n                            'Most CI servers set it automatically.\\n'\r\n                        )\r\n                    );\r\n                    return reject(new Error(messages.warnings.join('\\n\\n')));\r\n                }\r\n\r\n                return resolve({ stats, warnings: messages.warnings });\r\n            });\r\n        });\r\n    }\r\n\r\n    private formatWebpackMessages(json) {\r\n        const formattedErrors = json.errors.map((message) => {\r\n            return this.formatMessage(message);\r\n        });\r\n        const formattedWarnings = json.warnings.map((message) => {\r\n            return this.formatMessage(message);\r\n        });\r\n        const result = { errors: formattedErrors, warnings: formattedWarnings };\r\n        if (result.errors.some(this.isLikelyASyntaxError)) {\r\n            result.errors = result.errors.filter(this.isLikelyASyntaxError);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private isLikelyASyntaxError(message) {\r\n        return message.indexOf('Syntax error:') !== -1;\r\n    }\r\n\r\n    private formatMessage(message) {\r\n        let lines = message.split('\\n');\r\n        lines = lines.filter(line => !/Module [A-z ]+\\(from/.test(line));\r\n\r\n        lines = lines.map(line => {\r\n            const parsingError = /Line (\\d+):(?:(\\d+):)?\\s*Parsing error: (.+)$/.exec(\r\n                line\r\n            );\r\n            if (!parsingError) {\r\n                return line;\r\n            }\r\n            const [, errorLine, errorColumn, errorMessage] = parsingError;\r\n            return `${'Syntax error:'} ${errorMessage} (${errorLine}:${errorColumn})`;\r\n        });\r\n\r\n        message = lines.join('\\n');\r\n        message = message.replace(\r\n            /SyntaxError\\s+\\((\\d+):(\\d+)\\)\\s*(.+?)\\n/g,\r\n            `${'Syntax error:'} $3 ($1:$2)\\n`\r\n        );\r\n        message = message.replace(\r\n            /^.*export '(.+?)' was not found in '(.+?)'.*$/gm,\r\n            `Attempted import error: '$1' is not exported from '$2'.`\r\n        );\r\n        message = message.replace(\r\n            /^.*export 'default' \\(imported as '(.+?)'\\) was not found in '(.+?)'.*$/gm,\r\n            `Attempted import error: '$2' does not contain a default export (imported as '$1').`\r\n        );\r\n        message = message.replace(\r\n            /^.*export '(.+?)' \\(imported as '(.+?)'\\) was not found in '(.+?)'.*$/gm,\r\n            `Attempted import error: '$1' is not exported from '$3' (imported as '$2').`\r\n        );\r\n        lines = message.split('\\n');\r\n\r\n        if (lines.length > 2 && lines[1].trim() === '') {\r\n            lines.splice(1, 1);\r\n        }\r\n        lines[0] = lines[0].replace(/^(.*) \\d+:\\d+-\\d+$/, '$1');\r\n\r\n        if (lines[1] && lines[1].indexOf('Module not found: ') === 0) {\r\n            lines = [\r\n                lines[0],\r\n                lines[1]\r\n                    .replace('Error: ', '')\r\n                    .replace('Module not found: Cannot find file:', 'Cannot find file:'),\r\n            ];\r\n        }\r\n\r\n        if (lines[1] && lines[1].match(/Cannot find module.+node-sass/)) {\r\n            lines[1] = 'To import Sass files, you first need to install node-sass.\\n';\r\n            lines[1] +=\r\n                'Run `npm install node-sass` or `yarn add node-sass` inside your workspace.';\r\n        }\r\n\r\n        lines[0] = chalk.inverse(lines[0]);\r\n\r\n        message = lines.join('\\n');\r\n        message = message.replace(\r\n            /^\\s*at\\s((?!webpack:).)*:\\d+:\\d+[\\s)]*(\\n|$)/gm,\r\n            ''\r\n        );\r\n        message = message.replace(/^\\s*at\\s<anonymous>(\\n|$)/gm, '');\r\n        lines = message.split('\\n');\r\n\r\n        // Remove duplicated newlines\r\n        lines = lines.filter(\r\n            (line, index, arr) =>\r\n                index === 0 || line.trim() !== '' || line.trim() !== arr[index - 1].trim()\r\n        );\r\n\r\n        message = lines.join('\\n');\r\n        return message.trim();\r\n    }\r\n}"]}